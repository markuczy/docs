= OneCX integration-interface library

== Overview
`@onecx/integration-interface` library is a set of tools written in **Typescript** that enables communication between Microfrontends. The library can be used in any desired technology.

NOTE: For Angular based applications `@onecx/angular-integration-interface` library is available. It is a set of tools aiming to ease the development of Angular applications integrated with OneCX. For more information please refer xref:angular-integration-interface.adoc[here].

== Topics
include::partial$topic.adoc[]

=== Configuration Topic
Usage::
Pass and read information about the **platform configuration**.
Shell actions::
Loads Shell's configuration variables and publishes it.
Data::
**Object** with string entries, where each entry represents a configuration variable:
[source,typescript]
interface Config { [key: string]: string }

NOTE: For Angular based applications xref:angular-integration-interface.adoc#_configuration_service[`@onecx/angular-integration-interface` offers an Injectable ConfigurationService service] exposing functions usefull when dealing with configuration management.

=== Current Mfe Topic
Usage::
Read information about the **currently accessed Microfrontend**.
Shell actions::
On Route activation publishes information about accessed MFE.
Data::
**MfeInfo object** describing currently accessed Microfrontend with the following structure:

.MfeInfo structure
[cols="1,1,2"]
|===
|Property name |Type | Description

|appId |`string` | Unique identifier of the Microfrontend.
|baseHref |`string` | Microfrontend's base path within the current Workspace, i.e. `'/workspace/mfe_base_path'`.
|mountPath |`string` | Microfrontend's mount path containing Workspace and application base path, i.e. `'/workspace/mfe_base_path'`.
|productName |`string` | Name of the Application currently accessed Microfrontend is part of.
|remoteBaseUrl |`string` | Microfrontend's remote url to be used when accessing its content (remote entry file, assets, etc.), e.g. `'/mfe/mfe_name'`.
|shellName |`string` | Name of the currently used shell, always `'portal'`.
|displayName? |`string` | Name for Microfrontend to display.
|elementName? |`string` | Name of the html element Microfrontend's module should be displayed in, e.g. `'mfe-component'`
|remote? |`string` | ?
|remoteName? |`string` | Name of the remote set up in Microfrontend's webpack (Used for WebComponents integration within platform).
|version? |`string` | Version of the Microfrontend.
|===

=== Current Page Topic
Usage::
Read information about the **currently accessed Page**.
Important actions::
When creating Microfrontend's content use **PortalPageComponent**(**ocx-portal-page**). On its initialization, new PageInfo message will be published based on data provided to the component via Inputs.
Data::
**PageInfo object** describing currenly accessed Page with the following structure:

.PageInfo structure
[cols="1,1,2"]
|===
|Property name |Type | Description

|path | `string`| Complete path of the current Page containing Shell deployment path, Workspace base path and Microfrontend's accessed path, e.g. `'/shell/workspace/mfe/details/id-1'`
|applicationId? | `string`| ?
|helpArticleId? | `string`| Id of help article associated with the Page.
|pageName? | `string`| Unique name of the Page.
|permission? | `string`| Permission requried to access Page content.

|===

=== Current Theme Topic
Usage::
Read information about the **currently applied Theme**.
Shell actions::
During Workspace construction, Shell is going to load and apply Theme assigned to the Workspace. That Theme's information will be also published to the Topic.
Data::
**Theme object** describing currently applied Theme with the following structure:

.Theme structure
[cols="1,1,2"]
|===
|Property name |Type | Description

|assetsUpdateDate? | `string` | ?
|assetsUrl? | `string` | ?
|cssFile? | `string` | ?
|description? | `string` | Description of the Theme.
|faviconUrl? | `string` | ?
|id? |`string` | Unique identifier of the Theme.
|logoUrl? | `string` | Url to an external image to be used as Theme logo.
|name? | `string` | Name of the Theme
|previewImageUrl? | `string` | ?
|properties? | `{ [key: string]: { [key: string]: string } }` | Object containing css variables used for currently applied theme. It contains an entry for each section in the Theme designer (Font, General, Topbar, Sidebar) where key is the section name and value is an object containing key value pairs representing a certain css variable value to be used for a given Theme
|===

NOTE: For Angular based applications xref:angular-integration-interface.adoc#_theme_service[`@onecx/angular-integration-interface` offers an Injectable ThemeService service] exposing functions usefull when dealing with theme management.

=== Current Workspace Topic
Usage::
Read information about the **currently accessed Workspace**.
Shell actions::
During Workspace construction, Shell is going to publish its information to the Topic.
Data::
**Workspace object** describing currently accessed Workspace with the following structure:

.Workspace structure
[cols="1,1,2"]
|===
|Property name |Type | Description

|baseUrl | `string`| Base url of the Workspace, e.g. `'/admin'`.
|workspaceName | `string`| Name of the Workspace used as reference.
|companyName? | `string`| ?
|displayName? | `string`| Name of the Workspace used for display.
|footerLabel? | `string`| ?
|homePage? | `string`| Home page url relative to Workspace, e.g. `'/welcome'`.
|id? | `string`| Unique indentifier of Workspace.
|logoUrl? | `string`| ?
|logoSmallImageUrl? | `string`,| ?
|portalRoles? | `string[]`| ?
|routes? | `Array<<<Route-object, Route>>>`| List of routes to Microfrontends for a Workspace.
|themeId? | `string`| Id of the Theme used for the Workspace.
|themeName? | `string`| Name of the Theme used for the Workspace.
|===

[[Route-object]]
**Workspace object** contains list of routes for regsitered Microfrontends. Each **Route** has the following structure:

.Route structure
[cols="1,1,2"]
|===
|Property name |Type | Description

| appId |`string` | Unique identifier of the Microfrontend.
| baseUrl |`string` | Microfrontend's base path within the current workspace, i.e. `'/workspace/mfe_base_path'`.
| displayName |`string` | Name for Microfrontend to display.
| elementName |`string` | Name of the html element Microfrontend's module should be displayed in, e.g. `'mfe-component'`
| endpoints |`Array<Endpoint>` | Array of endpoints to be used by a Microfrontend to navigate to other MFEs safely. Each endpoint contains a name (string) and a path (string) that can be used when deciding on the url of the pages.
| exposedModule |`string` | Name of the exposed module to be loaded for a Microfrontend, e.g. `'./MfeModule'`
| pathMatch | `'full' \| 'prefix'` | Path matching stratedy of a Route.
| productName |`string` | Name of the Application currently accessed Microfrontend is part of.
| remoteEntryUrl |`string` | Url of the Microfrontend's remote entry file, e.g. `'mfe/mfe_base_path/remoteEntry.js'`.
| remoteName |`string` | Name of the remote set up in Microfrontend's webpack (Used for WebComponents integration within platform).
| technology |`'Angular' \| 'WebComponentScript' \| 'WebComponentModule'`  | Technology used to expose Microfrontend's module.
| url |`string` | Microfrontend's remote url to be used when accessing its content (remote entry file, assets, etc.), e.g. `'/mfe/mfe_name'`.
|===

=== Events Topic
Usage::
Write and read information about the **custom events within the platform**. Useful whenever it is desired to exchange information between Apps and no Topic has been created for that purpose.
Shell actions::
Shell is using EventsTopic to sync its router with navigation events happening in Microfrontend's routers (side-effect of xref:implementation-details/mfe-content-loading/webcomponents.adoc[using webcomponent loading mechanism]). The following event is used to exchange all navigation events within the OneCX platform:
[source,typescript]
type NavigatedEvent = {
    type: 'navigated';
    payload: NavigatedEventPayload;
};
type NavigatedEventPayload = {
    url: string | undefined;
    isFirst: boolean;
};

Data::
**Object** containing a type (to distingiush messages) and payload:

[source,typescript]
type TopicEvent Type = { type: string; payload?: unknown | undefined }

=== Global Error Topic
Usage::
Write and read information about the **global errors within the platform**.
Data::
**String** containing information about the global error raised within the platform.

=== Global Loading Topic
Usage::
Write and read information about the **global loading happening within the platform**.
Shell actions::
Shell sets the global loading indicator for the remote content loading period.
Data::
**Boolean** indicating wether global loading is happening or not.

=== Is Authenticated Topic
Usage::
Wait for an **authentication indicator** do certain actions. Whenever this topic is Initialized, App can assume that user accessing the page is authenticated.
Shell actions::
// TODO: Link to angular-auth for more info about auth mechanism
Shell uses AuthService from `@onecx/angular-auth` library for authentication. During Shell initialization (via APP_INITIALIZER), AuthService is initialized. On successful initialization, message is published to the Topic.
Data::
**Empty**

=== Message Topic
Usage::
Write **messages to be displayed in an overlay on the top of the page**. Useful when it is desired to inform about a certain event happening via a message displayed for a short period of time. Publish new message to display the message.
Data::
**Message object** describing message to be displayed with the following structure:

NOTE: **Message object** stucture is based on the https://primeng.org/toast[PrimeNG Toast API], which is used internally to display messages.

=== Permissions Topic
Usage::
Read **user's permissions related to current Microfrontend**.
Shell actions::
On Route activation publishes information about permissions related to the accessed MFE.
Data::
**Array<string>**, each representing user's permission.

=== Remote Components Topic
Usage::
Read **currently accessed Workspace Remote Components data**.
Shell actions::
During Workspace construction, Shell is going to publish information about available Slots and Components to the Topic.
Data::
**RemoteComponentsInfo object** describing available Remote Components and Slots with the following structure:

.RemoteComponentsInfo structure
[cols="1,1,2"]
|===
|Property name |Type | Description

|components | `<<RemoteComponent-object, RemoteComponent>>[]`| Registered Remote Components for Workspace.
|slots | `<<Slot-object, Slot>>[]`| Registered Slots for Workspace.
|===

[[RemoteComponent-object]]
**RemoteComponent object** describing Remote Component with the following structure:

.RemoteComponent structure
[cols="1,1,2"]
|===
|Property name |Type | Description

|name |`string` | Unique name of a Remote Component.
|baseUrl |`string` | Url of Remote Component's Microfrontend to be used when accessing its content (remote entry file, assets, etc.), e.g. `'/mfe/mfe_name'`.
|remoteEntryUrl |`string` |  Url of the Remote Component's Microfrontend remote entry file, e.g. `'mfe/mfe_base_path/remoteEntry.js'`.
|appId |`string` | Unique identifier of the Remote Component's Microfrontend.
|productName |`string` | Name of the Application currently accessed Remote Component's Microfrontend is part of.
|exposedModule |`string` | Name of the exposed Remote Component to be loaded, e.g. `'./MfeRemoteComponent'`
|remoteName |`string` | Name of the remote set up in Remote Component's Microfrontend webpack (Used for WebComponents integration within platform).
|technology |`'Angular' \| 'WebComponentScript' \| 'WebComponentModule'` | Technology used to expose Remote Component.
|===

[[Slot-object]]
**Slot** object describing Slot with the following structure:

.Slot structure
[cols="1,1,2"]
|===
|Property name |Type | Description

|name | `string`| Name of the Slot.
|components | `Array<string>`| List of Remote Component names registered for this Slot.
|===

=== User Profile Topic
Usage::
Read **current User information**.
Shell actions::
During Workspace construction, Shell is going to load and publish information about the current User to the Topic.
Data::
**UserProfile object** describing current User with the following structure:

.UserProfile structure
[cols="1,1,2"]
|===
|Property name |Type | Description

|person |`<<UserPerson-object, UserPerson>>` | User personal information.
|userId |`string` | User id in OneCX platform.
|accountSettings? |`<<UserProfileAccountSettings-object, UserProfileAccountSettings>>` | User's account settings.
|avatar? |`<<AvatarInfo-object, AvatarInfo>>` | ?
|id? |`string` | ?
|identityProvider? |`string` | ?
|identityProviderId? |`string` | User id in external identity provider.
|memberships? |`Array<<<Membership-object, Membership>>>` | ?
|organization? |`string` | Name of the User's organization.
|tenantId? |`string` | ?
|tenantName? |`string` | ?
|===

[[UserPerson-object]]
**UserPerson object** describing current User's personal info with the following structure:

.UserPerson structure
[cols="1,1,2"]
|===
|Property name |Type | Description

|firstName? |`string` | User's first name.
|lastName? |`string` | User's last name.
|displayName? |`string` | User's display name.
|email? |`string` | User's email.
|address? |`<<UserPersonAddress-object, UserPersonAddress>>` | User's address.
|phone? |`<<UserPersonPhone-object, UserPersonPhone>>` | User's phone.
|===

[[UserPersonAddress-object]]
**UserPersonAddress object** describing current User's address info with the following structure:

.UserPersonAddress structure
[cols="1,1,2"]
|===
|Property name |Type | Description

|street? |`string` | User's streat name.
|streetNo? |`string` | User's streat number.
|city? |`string` | User's city.
|postalCode? |`string` | User's postal code.
|country? |`string` | User's country.
|===

[[UserPersonPhone-object]]
**UserPersonPhone object** describing current User's phone info with the following structure:

.UserPersonPhone structure
[cols="1,1,2"]
|===
|Property name |Type | Description

|type? |`'MOBILE' \| 'LANDLINE'` | User's phone type.
|number? |`string` | User's phone number.
|===

[[UserProfileAccountSettings-object]]
**UserProfileAccountSettings object** describing current User's account settings with the following structure:

.UserProfileAccountSettings structure
[cols="1,1,2"]
|===
|Property name |Type | Description

|layoutAndThemeSettings? | `<<UserProfileAccountSettingsLayoutAndThemeSettings-object, UserProfileAccountSettingsLayoutAndThemeSettings>>`| User's layout and theme settings
|localeAndTimeSettings? | `<<UserProfileAccountSettingsLocaleAndTimeSettings-object, UserProfileAccountSettingsLocaleAndTimeSettings>>`| User's locale and time settings.
|notificationSettings? | `<<UserProfileAccountSettingsNotificationSettings-object, UserProfileAccountSettingsNotificationSettings>>`| User's notification settings.
|privacySettings? | `<<UserProfileAccountSettingsPrivacySettings-object, UserProfileAccountSettingsPrivacySettings>>`| User's privacy settings.
|===

[[UserProfileAccountSettingsLayoutAndThemeSettings-object]]
**UserProfileAccountSettingsLayoutAndThemeSettings object** describing current User's layout and theme settings with the following structure:

.UserProfileAccountSettingsLayoutAndThemeSettings structure
[cols="1,1,2"]
|===
|Property name |Type | Description

|menuMode? | `'HORIZONTAL' \| 'STATIC' \| 'OVERLAY' \| 'SLIM' \| 'SLIMPLUS'` | Menu mode set for User.
|colorScheme? | `'AUTO' \| 'LIGHT' \| 'DARK'` | Color scheme set for User.
|===

[[UserProfileAccountSettingsLocaleAndTimeSettings-object]]
**UserProfileAccountSettingsLocaleAndTimeSettings object** describing current User's locale and time settings with the following structure:

.UserProfileAccountSettingsLocaleAndTimeSettings structure
[cols="1,1,2"]
|===
|Property name |Type | Description

|locale? |`string` | User's locale.
|timezone? |`string` | User's timezone.
|===

[[UserProfileAccountSettingsNotificationSettings-object]]
**UserProfileAccountSettingsNotificationSettings object** describing current User's notification settings with the following structure:

// TODO: Decide what to do with this
.UserProfileAccountSettingsNotificationSettings structure
[cols="1,1,2"]
|===
|Property name |Type | Description
|===

[[UserProfileAccountSettingsPrivacySettings-object]]
**UserProfileAccountSettingsPrivacySettings object** describing current User's privacy settings with the following structure:

.UserProfileAccountSettingsPrivacySettings structure
[cols="1,1,2"]
|===
|Property name |Type | Description

|hideMyProfile? |`string` | ?
|===

[[AvatarInfo-object]]
**AvatarInfo object** describing current User's avatar info with the following structure:

.AvatarInfo structure
[cols="1,1,2"]
|===
|Property name |Type | Description

|userUploaded? | `boolean`| If User uploaded the avatar.
|lastUpdateTime? | `Date`| Last time User's avatar was updated.
|imageUrl? | `string`| Url to User's avatar image.
|smallImageUrl? | `string`| Url to User's avatar small image.
|===

[[Membership-object]]
**Membership object** describing current User's membership with the following structure:

// TODO: Decide what to do with this
.Membership structure
[cols="1,1,2"]
|===
|Property name |Type | Description
|===
